<!DOCTYPE html>
<html lang="en">
<head>
	<title>{{.ActiveProject.Name}} - Duit</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="icon" href="static/favicon.ico">
	<link rel="stylesheet" href="static/global.css">
</head>
<body style="
    background-color: var(--background);
    color: var(--on-surface);
    font-family: sans-serif;
    display: grid;
    grid-template-columns: minmax(10rem, 20rem) 1fr minmax(20rem, 50rem) 1fr;
    height: 100dvh;
">
    <script src="static/nav.js" type="module"></script>

    <nav style="
        background-color: var(--surface);
        padding: var(--sp2);
    ">
        <style>
            #project-list a {
                display: block;
                padding: var(--sp1) var(--sp2);
                border-radius: 3rem;
                color: inherit;
                text-decoration: none;

                &:hover {
                    background-color: var(--surface-bright);
                }

                &.active {
                    background-color: var(--secondary-container);
                    color: var(--on-secondary-container);
                }
            }
        </style>

        <ul id="project-list">
            {{$activeId := .ActiveProject.Id}}
            {{range .Projects}}
                <li data-id="{{.Id}}"><a href="/{{.Id}}" {{if eq .Id $activeId}}class="active"{{end}}>{{.Name}}</a></li>
            {{end}}
        </ul>
    </nav>

    <main style="
        grid-column: 3;
        padding: var(--sp3);
    ">
        <h1>{{.ActiveProject.Name}}</h1>

        <style>
            #task-list {
                li {
                    padding: var(--sp1) 0;
                    border-bottom: 1px solid var(--outline-variant);
                    display: flex;
                    align-items: center;
                    gap: var(--sp1);
                }

                .check {
                    --size: 1.2rem;
                    height: var(--size);
                    width: var(--size);
                    flex-shrink: 0;
                    border: 1px solid var(--outline);
                    border-radius: 50%;
                }
            }
        </style>

        <ul id="task-list">
            {{range .Tasks}}
                <li data-id="{{.Id}}">
                    <button class="check" aria-label="Mark task as complete"></button>
                    <div>
                        <p>{{ .Title }}</p>
                        {{ if .Date }}
                            <time datetime="{{ .FormatDate }}"></time>
                        {{ end }}
                    </div>
                </li>
            {{end}}
        </ul>
        <!-- Cloned for tasks created on client -->
        <template>
            <li>
                <button class="check"></button>
                <p></p>
            </li>
        </template>

        <style>
            #show-task-editor, #task-editor {
                margin-top: var(--sp1);
                &:not(.active) { display: none; }
            }

            #show-task-editor:hover {
                color: var(--on-secondary-container);
            }

            #name-input {
                span {
                    --size: 0.25rem;
                    background-color: var(--secondary-container);
                    padding: var(--size);
                    border-radius: var(--size);
                }
                &:focus {
                    outline: none;
                }
                &:empty::before {
                    content: "Task name";
                    color: var(--on-secondary-container);
                    pointer-events: none;
                    display: block;
                }
            }
        </style>

        <!-- Task editor -->
        <script src="static/task-editor.js" type="module"></script>

        <button id="show-task-editor" class="active">Add task</button>
        <form id="task-editor" style="
            border: 1px solid var(--outline);
            border-radius: var(--sp1);
            padding: var(--sp1);
        ">
            <!-- contenteditable is used to allow insertion of highlight spans -->
            <div
                id="name-input"
                contenteditable="plaintext-only"
                role="textbox"
                aria-label="Task name"
                style="white-space: pre-wrap;"
            >
            </div>
            <div style="
                display: flex;
                justify-content: end;
                gap: var(--sp1);"
            >
                <button class="base outlined" type="button" id="cancel-button">Cancel</button>
                <button class="base primary" type="submit">Add task</button>
            </div>
        </form>
    </main>
</body>
</html>
